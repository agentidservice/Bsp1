<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agentic Solutions ‚Äì Agent Demos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --page-bg: #0a0b0d;
      --page-text: #ffffff;
      --glass-border: rgba(255, 255, 255, 0.12);
      --shadow-strong: 0 25px 60px rgba(0, 0, 0, 0.6);
      --text: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.55);
      --gap: 20px;
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-sm: 12px;
      --widget-width: min(440px, 95vw);
      --widget-height: min(680px, 88vh);
      --accent: #d97706;
      --accent-light: #f59e0b;
      --success: #22c55e;
      --error: #ef4444;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: var(--page-bg);
      color: var(--page-text);
      font-family: 'Inter', system-ui, sans-serif;
    }
    .agentic-header {
      position: fixed; top: 0; right: 0; left: 0;
      padding: 16px 24px;
      display: flex; justify-content: flex-end; align-items: center;
      z-index: 100;
      background: linear-gradient(180deg, rgba(10, 11, 13, 0.98) 0%, rgba(10, 11, 13, 0.8) 70%, transparent 100%);
      pointer-events: none;
    }
    .agentic-badge {
      pointer-events: auto;
      display: flex; align-items: center; gap: 12px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 14px;
    }
    .agentic-badge-icon {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }
    .agentic-badge-text { display: flex; flex-direction: column; gap: 2px; }
    .agentic-badge-title { font-size: 14px; font-weight: 600; }
    .agentic-badge-subtitle { font-size: 11px; color: var(--text-muted); }
    .wrap { max-width: 900px; margin: 0 auto; padding: 100px 24px 180px; }
    .page-title { margin: 0 0 8px; font-size: clamp(28px, 4vw, 42px); font-weight: 600; }
    .page-subtitle { margin: 0 0 60px; color: var(--text-muted); font-size: 15px; line-height: 1.6; }
    .demo-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 20px; padding: 28px 32px;
    }
    .demo-card-header { display: flex; align-items: center; gap: 16px; margin-bottom: 10px; }
    .demo-card-icon {
      width: 52px; height: 52px; border-radius: 14px;
      display: flex; align-items: center; justify-content: center; font-size: 26px;
      background: linear-gradient(135deg, rgba(217, 119, 6, 0.2) 0%, rgba(245, 158, 11, 0.1) 100%);
      border: 1px solid rgba(217, 119, 6, 0.3);
    }
    .demo-card-title { font-size: 20px; font-weight: 600; margin: 0; }
    .demo-card-desc { color: var(--text-muted); font-size: 14px; margin: 0; }
    .demo-card-hint {
      display: inline-flex; align-items: center; gap: 6px;
      margin-top: 16px; padding: 8px 14px;
      background: rgba(255, 255, 255, 0.04); border-radius: 8px;
      font-size: 12px; color: var(--text-muted);
    }
    /* Widget */
    .widget { position: fixed; right: var(--gap); bottom: var(--gap); z-index: 9999; }
    .widget-toggle {
      width: 64px; height: 64px; border-radius: 50%;
      background: linear-gradient(135deg, #1a1816 0%, #252220 100%);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-strong);
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 28px;
      transition: transform 0.2s ease;
    }
    .widget-toggle:hover { transform: scale(1.08); }
    .widget-window {
      position: absolute; bottom: 76px; right: 0;
      width: var(--widget-width); height: var(--widget-height);
      max-height: calc(100vh - 100px);
      border-radius: var(--radius-lg); overflow: hidden;
      box-shadow: var(--shadow-strong);
      border: 1px solid var(--glass-border);
      background: rgba(22, 20, 16, 0.95);
      backdrop-filter: blur(20px);
      display: none; flex-direction: column;
    }
    .widget-window.is-open { display: flex; }
    .widget-header {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.3);
    }
    .widget-header-title {
      font-family: 'Playfair Display', serif;
      font-size: 22px; font-weight: 600; margin: 0 0 4px 0;
    }
    .widget-header-subtitle { font-size: 13px; color: var(--text-muted); margin: 0; }
    .widget-body { flex: 1; overflow-y: auto; padding: 20px 24px; }
    .widget-body::-webkit-scrollbar { width: 6px; }
    .widget-body::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.15); border-radius: 3px; }
    /* Form Elements */
    .welcome-box {
      background: rgba(217, 119, 6, 0.1);
      border: 1px solid rgba(217, 119, 6, 0.2);
      border-radius: var(--radius-md); padding: 16px; margin-bottom: 24px;
    }
    .welcome-box p { font-size: 14px; line-height: 1.6; margin: 0; }
    .welcome-box strong { color: var(--accent-light); }
    .form-section { margin-bottom: 20px; }
    .form-section-title {
      font-size: 11px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 1px; color: var(--accent-light); margin-bottom: 12px;
    }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 13px; font-weight: 500; color: var(--text-muted); margin-bottom: 6px; }
    .form-label .required { color: var(--error); }
    .form-input, .form-select {
      width: 100%; padding: 12px 14px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      color: var(--text); font-size: 14px; font-family: inherit;
      transition: all 0.2s ease;
    }
    .form-input:focus, .form-select:focus {
      outline: none; border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.2);
    }
    .form-input::placeholder { color: rgba(255, 255, 255, 0.3); }
    .form-input.valid { border-color: var(--success); }
    .form-input.invalid { border-color: var(--error); }
    .form-select {
      cursor: pointer; appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%238892b0' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 12px center; background-size: 16px;
    }
    .form-select option { background: #1a1816; }
    .radio-group { display: flex; gap: 12px; }
    .radio-option { flex: 1; }
    .radio-option input { position: absolute; opacity: 0; }
    .radio-option label {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      cursor: pointer; font-size: 14px; font-weight: 500;
      transition: all 0.2s ease;
    }
    .radio-option input:checked + label {
      background: rgba(217, 119, 6, 0.2);
      border-color: var(--accent); color: var(--accent-light);
    }
    /* Validation Box */
    .validation-box {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md); padding: 16px; margin-bottom: 20px;
    }
    .validation-box-title {
      font-size: 12px; font-weight: 600; color: var(--text-muted);
      margin-bottom: 12px; display: flex; align-items: center; gap: 6px;
    }
    .validation-row { display: flex; gap: 10px; margin-bottom: 12px; }
    .validation-row .form-input { flex: 1; }
    .validate-btn {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: var(--radius-sm);
      color: var(--text); font-size: 13px; font-weight: 500;
      cursor: pointer; white-space: nowrap;
      display: flex; align-items: center; gap: 6px;
      transition: all 0.2s ease;
    }
    .validate-btn:hover { background: rgba(255, 255, 255, 0.1); border-color: var(--accent); }
    .validate-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .validate-btn .spinner {
      width: 14px; height: 14px;
      border: 2px solid transparent; border-top-color: var(--text);
      border-radius: 50%; animation: spin 0.8s linear infinite;
      display: none;
    }
    .validate-btn.loading .spinner { display: block; }
    .validate-btn.loading .btn-icon { display: none; }
    .validation-status {
      padding: 10px 12px; border-radius: 8px; font-size: 13px;
      display: none; align-items: center; gap: 8px;
    }
    .validation-status.visible { display: flex; }
    .validation-status.success { background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.3); color: var(--success); }
    .validation-status.error { background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); color: var(--error); }
    .conditional-field { display: none; animation: fadeIn 0.3s ease; }
    .conditional-field.visible { display: block; }
    .phone-wrapper { position: relative; }
    .phone-status { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 16px; }
    /* File Upload */
    .file-upload {
      border: 2px dashed rgba(255, 255, 255, 0.15);
      border-radius: var(--radius-sm); padding: 20px; text-align: center;
      cursor: pointer; position: relative; transition: all 0.2s ease;
    }
    .file-upload:hover { border-color: var(--accent); background: rgba(217, 119, 6, 0.05); }
    .file-upload input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
    .file-upload-icon { font-size: 28px; margin-bottom: 8px; }
    .file-upload-text { font-size: 13px; color: var(--text-muted); }
    .file-upload-hint { font-size: 11px; color: rgba(255, 255, 255, 0.35); margin-top: 4px; }
    .file-list { margin-top: 12px; display: flex; flex-wrap: wrap; gap: 8px; }
    .file-item {
      display: flex; align-items: center; gap: 6px;
      padding: 6px 10px; background: rgba(217, 119, 6, 0.15);
      border-radius: 6px; font-size: 12px;
    }
    .file-item-remove { cursor: pointer; color: var(--error); font-weight: bold; margin-left: 4px; }
    /* Checklist */
    .validation-checklist {
      background: rgba(0, 0, 0, 0.2);
      border-radius: var(--radius-sm); padding: 14px 16px;
      margin-top: 20px; margin-bottom: 10px;
    }
    .validation-checklist-title {
      font-size: 11px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 1px; color: var(--text-muted); margin-bottom: 10px;
    }
    .checklist-item {
      display: flex; align-items: center; gap: 10px;
      padding: 6px 0; font-size: 13px; color: var(--text-muted);
    }
    .checklist-item.checked { color: var(--success); }
    .checklist-icon {
      width: 18px; height: 18px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; flex-shrink: 0;
    }
    .checklist-item.checked .checklist-icon { background: var(--success); color: white; }
    .checklist-item.unchecked .checklist-icon { background: rgba(255, 255, 255, 0.1); }

    /* DSGVO (NEU) */
    .dsgvo-box {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      padding: 14px 16px;
      margin-top: 10px;
    }
    .dsgvo-row {
      display: flex; align-items: flex-start; gap: 10px;
      font-size: 13px; color: var(--text-muted);
      line-height: 1.45;
      cursor: pointer;
      user-select: none;
    }
    .dsgvo-row input {
      margin-top: 3px;
      accent-color: var(--accent-light);
    }
    .dsgvo-toggle {
      background: none;
      border: none;
      color: var(--accent-light);
      cursor: pointer;
      padding: 0;
      font-size: 13px;
      text-decoration: underline;
    }
    .dsgvo-details {
      display: none;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 12px;
      color: rgba(255, 255, 255, 0.45);
      animation: fadeIn 0.25s ease;
    }
    .dsgvo-details.visible { display: block; }

    /* Submit Button */
    .submit-btn {
      width: 100%; padding: 16px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      border: none; border-radius: var(--radius-sm);
      color: #ffffff; font-size: 15px; font-weight: 600;
      cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
      transition: all 0.2s ease; margin-top: 24px;
    }
    .submit-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(217, 119, 6, 0.35); }
    .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .submit-btn .spinner {
      width: 18px; height: 18px;
      border: 2px solid transparent; border-top-color: #ffffff;
      border-radius: 50%; animation: spin 0.8s linear infinite; display: none;
    }
    .submit-btn.loading .spinner { display: block; }
    .submit-btn.loading .btn-text { display: none; }
    /* Result View */
    .result-view { display: none; }
    .result-view.visible { display: block; animation: fadeIn 0.4s ease; }
    .result-success { text-align: center; padding: 20px 0; }
    .result-success-icon { font-size: 48px; margin-bottom: 12px; }
    .result-success h3 { font-size: 20px; font-weight: 600; margin: 0 0 8px 0; }
    .result-success p { font-size: 14px; color: var(--text-muted); margin: 0; }
    .result-summary {
      background: rgba(0, 0, 0, 0.3);
      border-radius: var(--radius-md); padding: 20px; margin: 24px 0;
    }
    .result-summary-title {
      font-size: 12px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 1px; color: var(--accent-light); margin-bottom: 16px;
    }
    .result-row {
      display: flex; justify-content: space-between;
      padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 14px;
    }
    .result-row:last-child { border-bottom: none; }
    .result-row .label { color: var(--text-muted); }
    .result-row .value { color: var(--text); font-weight: 500; text-align: right; }
    .result-row.highlight {
      background: rgba(217, 119, 6, 0.15);
      margin: 10px -20px; padding: 14px 20px;
      border-radius: 8px; border-bottom: none;
    }
    .result-row.highlight .value { font-size: 22px; color: var(--accent-light); }
    .result-divider { height: 1px; background: rgba(255, 255, 255, 0.1); margin: 16px 0; }
    .email-prompt {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md); padding: 16px; text-align: center;
    }
    .email-prompt p { font-size: 14px; margin: 0 0 14px 0; }
    .email-prompt-buttons { display: flex; gap: 10px; }
    .email-prompt-buttons button {
      flex: 1; padding: 12px; border-radius: 8px;
      font-size: 14px; font-weight: 600; cursor: pointer;
    }
    .btn-email-yes { background: var(--success); border: none; color: white; }
    .btn-email-no { background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-muted); }
    .btn-new-request {
      width: 100%; padding: 14px; background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: var(--radius-sm); color: var(--text-muted);
      font-size: 14px; font-weight: 500; cursor: pointer; margin-top: 16px;
    }
    .loading-overlay {
      position: absolute; inset: 0;
      background: rgba(22, 20, 16, 0.95);
      display: none; flex-direction: column;
      align-items: center; justify-content: center; z-index: 100;
    }
    .loading-overlay.visible { display: flex; }
    .loading-spinner {
      width: 48px; height: 48px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--accent);
      border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 16px;
    }
    .loading-text { font-size: 14px; color: var(--text-muted); }
    .toast {
      position: fixed; bottom: 100px; left: 50%;
      transform: translateX(-50%) translateY(20px);
      padding: 14px 24px; background: var(--success); color: white;
      border-radius: 10px; font-size: 14px; font-weight: 500;
      opacity: 0; pointer-events: none;
      transition: all 0.3s ease; z-index: 10000;
    }
    .toast.visible { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast.error { background: var(--error); }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @media (max-width: 768px) {
      .widget-window { width: calc(100vw - 24px); height: calc(100vh - 100px); right: -8px; }
      .validation-row { flex-direction: column; }
      .validate-btn { width: 100%; justify-content: center; }
    }
  </style>
</head>
<body>
  <header class="agentic-header">
    <div class="agentic-badge">
      <div class="agentic-badge-icon">‚ö°</div>
      <div class="agentic-badge-text">
        <span class="agentic-badge-title">Agentic Solutions</span>
        <span class="agentic-badge-subtitle">Demo-Agents Showcase</span>
      </div>
    </div>
  </header>

  <div class="wrap">
    <h1 class="page-title">KI-Assistenten in Aktion</h1>
    <p class="page-subtitle">Erlebe unseren intelligenten Malerbetrieb-Assistenten live. Klicke auf den Button unten rechts, um eine Anfrage zu stellen.</p>
    <div class="demo-card">
      <div class="demo-card-header">
        <div class="demo-card-icon">üé®</div>
        <div>
          <h2 class="demo-card-title">ProjektBauGG Malerbetrieb</h2>
          <p class="demo-card-desc">Professionelle Malerarbeiten in Paderborn und Umgebung. F√ºllen Sie das Formular aus und erhalten Sie sofort eine Preissch√§tzung.</p>
        </div>
      </div>
      <div class="demo-card-hint">Formular √∂ffnen mit dem üé® Button</div>
    </div>
  </div>

  <!-- WIDGET -->
  <div class="widget" id="widget">
    <div class="widget-toggle" id="widget-toggle">üé®</div>
    <div class="widget-window" id="widget-window">
      <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Anfrage wird verarbeitet...</div>
      </div>
      <div class="widget-header">
        <h2 class="widget-header-title">üé® Malerbetrieb</h2>
        <p class="widget-header-subtitle">ProjektBauGG GmbH ‚Ä¢ Paderborn</p>
      </div>
      <div class="widget-body" id="widget-body">
        <!-- FORM VIEW -->
        <div class="form-view" id="form-view">
          <div class="welcome-box">
            <p><strong>Willkommen!</strong> F√ºllen Sie das Formular aus, um eine <strong>kostenlose Preissch√§tzung</strong> zu erhalten.</p>
          </div>
          <form id="contact-form">
            <!-- Kundentyp -->
            <div class="form-section">
              <div class="form-section-title">Kundentyp</div>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" id="type-privat" name="customerType" value="privat" checked>
                  <label for="type-privat">üè† Privat</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="type-gewerbe" name="customerType" value="gewerbe">
                  <label for="type-gewerbe">üè¢ Gewerblich</label>
                </div>
              </div>
            </div>

            <!-- GEWERBE: Firma + Ort -->
            <div class="validation-box conditional-field" id="gewerbe-validation">
              <div class="validation-box-title">üîç Firma & Standort pr√ºfen</div>
              <div class="form-group" style="margin-bottom: 12px;">
                <label class="form-label">Firmenname <span class="required">*</span></label>
                <input type="text" class="form-input" id="company" placeholder="Name Ihrer Firma">
              </div>
              <div class="validation-row">
                <input type="text" class="form-input" id="location-gewerbe" placeholder="Ort des Objekts">
                <button type="button" class="validate-btn" id="validate-gewerbe-btn">
                  <span class="spinner"></span>
                  <span class="btn-icon">üîç</span>
                  Pr√ºfen
                </button>
              </div>
              <div class="validation-status" id="gewerbe-status"></div>
            </div>

            <!-- PRIVAT: Nur Ort -->
            <div class="validation-box" id="privat-validation">
              <div class="validation-box-title">üîç Standort pr√ºfen</div>
              <div class="validation-row">
                <input type="text" class="form-input" id="location-privat" placeholder="Ort des Objekts (Stadt oder PLZ)">
                <button type="button" class="validate-btn" id="validate-privat-btn">
                  <span class="spinner"></span>
                  <span class="btn-icon">üîç</span>
                  Pr√ºfen
                </button>
              </div>
              <div class="validation-status" id="privat-status"></div>
            </div>

            <!-- Name -->
            <div class="form-group">
              <label class="form-label">Ihr Name <span class="required">*</span></label>
              <input type="text" class="form-input" id="name" placeholder="Vor- und Nachname" required>
            </div>

            <!-- Telefon -->
            <div class="form-group">
              <label class="form-label">Telefonnummer <span class="required">*</span></label>
              <div class="phone-wrapper">
                <input type="tel" class="form-input" id="phone" placeholder="z.B. 0151 12345678" required>
                <span class="phone-status" id="phone-status"></span>
              </div>
            </div>

            <!-- Leistung -->
            <div class="form-section">
              <div class="form-section-title">Projektdetails</div>
              <div class="form-group">
                <label class="form-label">Gew√ºnschte Leistung <span class="required">*</span></label>
                <select class="form-select" id="service" required>
                  <option value="">Bitte w√§hlen...</option>
                  <option value="1">Innenw√§nde streichen</option>
                  <option value="2">Fassade streichen</option>
                  <option value="3">Tapezieren</option>
                  <option value="4">T√ºren / Fenster lackieren</option>
                  <option value="5">Verputzen / Grundieren</option>
                  <option value="6">Dekorative Techniken</option>
                </select>
              </div>
            </div>

            <!-- Gr√∂√üe -->
            <div class="form-group">
              <label class="form-label">Ungef√§hre Gr√∂√üe <span class="required">*</span></label>
              <input type="text" class="form-input" id="size" placeholder="z.B. 50 m¬≤ oder 3 T√ºren" required>
            </div>

            <!-- Zeitraum -->
            <div class="form-group">
              <label class="form-label">Gew√ºnschter Zeitraum <span class="required">*</span></label>
              <input type="text" class="form-input" id="timeframe" placeholder="z.B. Anfang M√§rz, KW 12" required>
            </div>

            <!-- Bilder -->
            <div class="form-group">
              <label class="form-label">Bilder vom Objekt (optional)</label>
              <div class="file-upload">
                <input type="file" id="images" multiple accept="image/*">
                <div class="file-upload-icon">üì∑</div>
                <div class="file-upload-text">Bilder hier ablegen oder klicken</div>
                <div class="file-upload-hint">JPG, PNG bis 10MB</div>
              </div>
              <div class="file-list" id="file-list"></div>
            </div>

            <!-- Checklist -->
            <div class="validation-checklist">
              <div class="validation-checklist-title">Checkliste vor Absenden</div>
              <div class="checklist-item unchecked" id="check-location">
                <span class="checklist-icon">‚óã</span>
                <span>Standort gepr√ºft</span>
              </div>
              <div class="checklist-item unchecked" id="check-phone">
                <span class="checklist-icon">‚óã</span>
                <span>Telefonnummer g√ºltig</span>
              </div>
            </div>

            <!-- DSGVO (NEU) -->
            <div class="dsgvo-box" id="dsgvo-box">
              <label class="dsgvo-row" for="dsgvo-checkbox">
                <input type="checkbox" id="dsgvo-checkbox">
                <span>
                  Ich stimme der Verarbeitung meiner Daten gem√§√ü
                  <button type="button" class="dsgvo-toggle" id="dsgvo-toggle">Datenschutz</button>
                  zu.
                </span>
              </label>

              <div class="dsgvo-details" id="dsgvo-details">
                <div>
                  <strong style="color: var(--accent-light); font-weight: 600;">Kurzinfo:</strong>
                  Ihre Angaben werden ausschlie√ülich zur Bearbeitung Ihrer Anfrage verwendet und nicht an Dritte weitergegeben.
                  Rechtsgrundlage ist Art. 6 Abs. 1 lit. b DSGVO (vorvertragliche Ma√ünahmen).
                  Sie k√∂nnen Ihre Einwilligung jederzeit mit Wirkung f√ºr die Zukunft widerrufen.
                </div>
              </div>
            </div>

            <button type="submit" class="submit-btn" id="submit-btn" disabled>
              <span class="spinner"></span>
              <span class="btn-text">üöÄ Anfrage absenden</span>
            </button>
          </form>
        </div>

        <!-- RESULT VIEW -->
        <div class="result-view" id="result-view">
          <div class="result-success">
            <div class="result-success-icon">‚úÖ</div>
            <h3>Anfrage erhalten!</h3>
            <p>Hier ist Ihre Projekt√ºbersicht</p>
          </div>
          <div class="result-summary">
            <div class="result-summary-title">üìã Zusammenfassung</div>
            <div class="result-row"><span class="label">Kundentyp</span><span class="value" id="result-type">-</span></div>
            <div class="result-row" id="result-company-row" style="display:none"><span class="label">Firma</span><span class="value" id="result-company">-</span></div>
            <div class="result-row"><span class="label">Name</span><span class="value" id="result-name">-</span></div>
            <div class="result-row"><span class="label">Telefon</span><span class="value" id="result-phone">-</span></div>
            <div class="result-row"><span class="label">Standort</span><span class="value" id="result-location">-</span></div>
            <div class="result-divider"></div>
            <div class="result-row"><span class="label">Leistung</span><span class="value" id="result-service">-</span></div>
            <div class="result-row"><span class="label">Umfang</span><span class="value" id="result-size">-</span></div>
            <div class="result-row"><span class="label">Zeitraum</span><span class="value" id="result-timeframe">-</span></div>
            <div class="result-divider"></div>
            <div class="result-row"><span class="label">üìÖ Gesch√§tzte Dauer</span><span class="value" id="result-duration">-</span></div>
            <div class="result-row"><span class="label">üë∑ Mitarbeiter</span><span class="value" id="result-workers">-</span></div>
            <div class="result-row highlight"><span class="label">üí∞ Preissch√§tzung</span><span class="value" id="result-price">-</span></div>
          </div>
          <p style="font-size:12px;color:var(--text-muted);text-align:center;margin-bottom:20px;">Dies ist eine unverbindliche Sch√§tzung. Nach Besichtigung kann der Preis um ¬±15-20% abweichen.</p>
          <div class="email-prompt" id="email-prompt">
            <p>üìß Soll ich Ihnen die Zusammenfassung auch per E-Mail schicken?</p>
            <div class="email-prompt-buttons">
              <button type="button" class="btn-email-yes" id="btn-email-yes">Ja, bitte!</button>
              <button type="button" class="btn-email-no" id="btn-email-no">Nein, danke</button>
            </div>
          </div>
          <div class="form-group" id="email-input-group" style="display:none;margin-top:16px;">
            <label class="form-label">Ihre E-Mail-Adresse</label>
            <input type="email" class="form-input" id="email-address" placeholder="email@beispiel.de">
            <button type="button" class="submit-btn" id="send-email-btn" style="margin-top:12px;">
              <span class="spinner"></span>
              <span class="btn-text">üìß E-Mail senden</span>
            </button>
          </div>
          <button type="button" class="btn-new-request" id="btn-new-request">‚Üê Neue Anfrage stellen</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    (function() {
      // ============ WEBHOOKS ============
      const WEBHOOK_VALIDATE  = "https://seidel1502.app.n8n.cloud/webhook/4c66b127-be26-4b5c-8e0a-dedffdcc92b0";
const WEBHOOK_CALCULATE = "https://seidel1502.app.n8n.cloud/webhook/d71b1438-46b7-4d67-9517-c0b2d2be92bd";
const WEBHOOK_EMAIL     = "https://seidel1502.app.n8n.cloud/webhook/d71b1438-46b7-4d67-9517-c0b2d2be92bd";


      const SERVICE_NAMES = {
        1: "Innenw√§nde streichen", 2: "Fassade streichen", 3: "Tapezieren",
        4: "T√ºren/Fenster lackieren", 5: "Verputzen/Grundieren", 6: "Dekorative Techniken"
      };

      const $ = id => document.getElementById(id);

      // (NEU) DSGVO in validationState integriert
      let validationState = { locationValid: false, phoneValid: false, dsgvoAccepted: false, distance: null };

      let uploadedFiles = [];
      let currentRequestId = null;
      let currentFormData = {};

      // Toggle Widget
      $('widget-toggle').onclick = () => $('widget-window').classList.toggle('is-open');

      // Customer Type Toggle
      document.querySelectorAll('input[name="customerType"]').forEach(r => {
        r.onchange = e => {
          const isGewerbe = e.target.value === 'gewerbe';
          $('gewerbe-validation').classList.toggle('visible', isGewerbe);
          $('privat-validation').style.display = isGewerbe ? 'none' : 'block';
          validationState.locationValid = false;
          updateUI();
        };
      });

      // (NEU) DSGVO Details Toggle
      $('dsgvo-toggle').onclick = () => {
        $('dsgvo-details').classList.toggle('visible');
      };

      // (NEU) DSGVO Checkbox Pflicht
      $('dsgvo-checkbox').onchange = e => {
        validationState.dsgvoAccepted = !!e.target.checked;
        updateUI();
      };

      // Validate GEWERBE
      $('validate-gewerbe-btn').onclick = async () => {
        const company = $('company').value.trim();
        const location = $('location-gewerbe').value.trim();
        if (!company || !location) return showStatus('gewerbe-status', 'error', '‚ùå Bitte Firmenname und Ort eingeben');

        const btn = $('validate-gewerbe-btn');
        btn.classList.add('loading'); btn.disabled = true;

        try {
          const res = await fetch(WEBHOOK_VALIDATE, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type: 'gewerbe', company, location })
          });
          const data = await res.json();

          if (data.valid) {
            validationState.locationValid = true;
            validationState.distance = data.distance;
            showStatus('gewerbe-status', 'success', `‚úÖ ${data.companyInfo || company} gefunden! Entfernung: ${data.distance}km`);
          } else {
            validationState.locationValid = false;
            showStatus('gewerbe-status', 'error', data.message || '‚ùå Firma nicht gefunden oder au√üerhalb des Einsatzgebiets');
          }
        } catch (e) {
          showStatus('gewerbe-status', 'error', '‚ùå Pr√ºfung fehlgeschlagen');
        }
        btn.classList.remove('loading'); btn.disabled = false;
        updateUI();
      };

      // Validate PRIVAT
      $('validate-privat-btn').onclick = async () => {
        const location = $('location-privat').value.trim();
        if (!location) return showStatus('privat-status', 'error', '‚ùå Bitte Ort eingeben');

        const btn = $('validate-privat-btn');
        btn.classList.add('loading'); btn.disabled = true;

        try {
          const res = await fetch(WEBHOOK_VALIDATE, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type: 'privat', location })
          });
          const data = await res.json();

          if (data.valid) {
            validationState.locationValid = true;
            validationState.distance = data.distance;
            showStatus('privat-status', 'success', `‚úÖ Im Einsatzgebiet! Entfernung: ${data.distance}km`);
          } else {
            validationState.locationValid = false;
            const msg = data.distance ? `‚ùå Au√üerhalb (${data.distance}km). Max. 30km.` : '‚ùå Ort nicht gefunden';
            showStatus('privat-status', 'error', msg);
          }
        } catch (e) {
          showStatus('privat-status', 'error', '‚ùå Pr√ºfung fehlgeschlagen');
        }
        btn.classList.remove('loading'); btn.disabled = false;
        updateUI();
      };

      // Phone Validation (Frontend)
      $('phone').oninput = e => {
        const phone = e.target.value.replace(/\s/g, '');
        const valid = /^(\+49|0)[1-7]\d{8,11}$/.test(phone);

        $('phone-status').textContent = phone.length === 0 ? '' : valid ? '‚úÖ' : phone.length >= 6 ? '‚ùå' : '';
        $('phone').classList.toggle('valid', valid);
        $('phone').classList.toggle('invalid', phone.length >= 6 && !valid);
        validationState.phoneValid = valid;
        updateUI();
      };

      // Helpers
      function showStatus(id, type, msg) {
        $(id).className = `validation-status visible ${type}`;
        $(id).textContent = msg;
      }

      function updateUI() {
        const loc = $('check-location'), ph = $('check-phone');
        loc.className = validationState.locationValid ? 'checklist-item checked' : 'checklist-item unchecked';
        loc.querySelector('.checklist-icon').textContent = validationState.locationValid ? '‚úì' : '‚óã';
        ph.className = validationState.phoneValid ? 'checklist-item checked' : 'checklist-item unchecked';
        ph.querySelector('.checklist-icon').textContent = validationState.phoneValid ? '‚úì' : '‚óã';

        // (NEU) DSGVO muss ebenfalls erf√ºllt sein
        $('submit-btn').disabled = !(validationState.locationValid && validationState.phoneValid && validationState.dsgvoAccepted);
      }

      function showToast(msg, type = 'success') {
        $('toast').textContent = msg;
        $('toast').className = 'toast visible' + (type === 'error' ? ' error' : '');
        setTimeout(() => $('toast').classList.remove('visible'), 3500);
      }

      // File Upload
      $('images').onchange = e => {
        Array.from(e.target.files).forEach(f => {
          if (f.size > 10 * 1024 * 1024) return showToast('Datei zu gro√ü', 'error');
          uploadedFiles.push(f);
        });
        renderFiles();
        e.target.value = '';
      };

      function renderFiles() {
        $('file-list').innerHTML = uploadedFiles.map((f, i) =>
          `<div class="file-item">üì∑ ${f.name.slice(0,20)}${f.name.length>20?'...':''}<span class="file-item-remove" data-i="${i}">‚úï</span></div>`
        ).join('');
        $('file-list').querySelectorAll('.file-item-remove').forEach(b => b.onclick = e => {
          uploadedFiles.splice(+e.target.dataset.i, 1);
          renderFiles();
        });
      }

      // Form Submit
      $('contact-form').onsubmit = async e => {
        e.preventDefault();

        // (NEU) DSGVO ist Pflicht
        if (!validationState.locationValid || !validationState.phoneValid || !validationState.dsgvoAccepted) return;

        $('loading-overlay').classList.add('visible');
        $('submit-btn').disabled = true;

        const isGewerbe = document.querySelector('input[name="customerType"]:checked').value === 'gewerbe';
        const serviceId = +$('service').value;
        const sizeNum = parseFloat($('size').value.replace(/[^\d.,]/g, '').replace(',', '.')) || 30;

        currentFormData = {
          customerType: isGewerbe ? 'gewerbe' : 'privat',
          company: isGewerbe ? $('company').value : '',
          name: $('name').value,
          phone: $('phone').value,
          location: isGewerbe ? $('location-gewerbe').value : $('location-privat').value,
          distance: validationState.distance,
          serviceId, serviceName: SERVICE_NAMES[serviceId] || '',
          size: $('size').value, sizeNumber: sizeNum,
          timeframe: $('timeframe').value,
          imagesCount: uploadedFiles.length,
          dsgvoAccepted: true,                 // (NEU) f√ºrs Backend
          timestamp: new Date().toISOString()
        };

        try {
          const fd = new FormData();
          fd.append('formData', JSON.stringify(currentFormData));
          uploadedFiles.forEach((f, i) => fd.append(`image_${i}`, f));

          const res = await fetch(WEBHOOK_CALCULATE, { method: 'POST', body: fd });
          const data = await res.json();
          currentRequestId = data.requestId;
          showResult(currentFormData, data);
        } catch (e) {
          showToast('Fehler beim Senden', 'error');
        }
        $('loading-overlay').classList.remove('visible');
        updateUI();
      };

      function showResult(d, r) {
        $('result-type').textContent = d.customerType === 'gewerbe' ? 'Gewerblich üè¢' : 'Privat üè†';
        $('result-company-row').style.display = d.company ? 'flex' : 'none';
        $('result-company').textContent = d.company;
        $('result-name').textContent = d.name;
        $('result-phone').textContent = d.phone;
        $('result-location').textContent = `${d.location} (${d.distance}km)`;
        $('result-service').textContent = d.serviceName;
        $('result-size').textContent = d.size;
        $('result-timeframe').textContent = d.timeframe;
        $('result-duration').textContent = r.duration || '-';
        $('result-workers').textContent = r.workers || '-';
        $('result-price').textContent = r.price ? `ca. ${r.price.toLocaleString('de-DE')} ‚Ç¨` : '-';

        $('form-view').style.display = 'none';
        $('result-view').classList.add('visible');
        $('widget-body').scrollTop = 0;
      }

      // Email
      $('btn-email-yes').onclick = () => { $('email-prompt').style.display = 'none'; $('email-input-group').style.display = 'block'; };
      $('btn-email-no').onclick = () => { $('email-prompt').style.display = 'none'; showToast('Vielen Dank! Wir melden uns bald. üìû'); };

      $('send-email-btn').onclick = async () => {
        const email = $('email-address').value;
        if (!email.includes('@')) return showToast('Bitte g√ºltige E-Mail', 'error');

        $('send-email-btn').classList.add('loading');
        try {
          await fetch(WEBHOOK_EMAIL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ requestId: currentRequestId, email, formData: currentFormData })
          });
          showToast('üìß E-Mail versendet!');
          $('email-input-group').style.display = 'none';
        } catch (e) { showToast('Fehler', 'error'); }
        $('send-email-btn').classList.remove('loading');
      };

      // Reset
      $('btn-new-request').onclick = () => {
        $('contact-form').reset();
        uploadedFiles = [];
        $('file-list').innerHTML = '';
        validationState = { locationValid: false, phoneValid: false, dsgvoAccepted: false, distance: null };

        $('gewerbe-validation').classList.remove('visible');
        $('privat-validation').style.display = 'block';
        $('gewerbe-status').classList.remove('visible');
        $('privat-status').classList.remove('visible');
        $('phone').classList.remove('valid', 'invalid');
        $('phone-status').textContent = '';

        // (NEU) DSGVO Reset
        $('dsgvo-checkbox').checked = false;
        $('dsgvo-details').classList.remove('visible');

        $('email-prompt').style.display = 'block';
        $('email-input-group').style.display = 'none';
        updateUI();
        $('result-view').classList.remove('visible');
        $('form-view').style.display = 'block';
        $('widget-body').scrollTop = 0;
      };
    })();
  </script>
</body>
</html>
